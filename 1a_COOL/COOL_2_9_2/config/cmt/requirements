package COOL

#============================================================================
# Project components
#============================================================================

use CoolKernel      v*
use CoolApplication v*
use RelationalCool  v*
use PyCool          v*
use PyCoolUtilities v*
use Examples        v*

use CoolDBDiscovery    v* Utilities
use ACE                v* Utilities

# These two tools are no longer supported (bug #95364)
###use CoolMiniClient     v* Utilities
###use VerificationClient v* Utilities

include_path none

#============================================================================
# Private dependencies, build rules and runtime
#============================================================================

private

#----------------------------------------------------------------------------
# COOL runtime
#----------------------------------------------------------------------------

use COOL v* LCG_Interfaces
apply_tag NEEDS_COOL_FACTORY
apply_tag NEEDS_PYCOOL

#---------------------------------------------------------------------------- 
# ROOT6 runtime/relocability in PyCool (see bug #103539 and bug #103298)
#---------------------------------------------------------------------------- 

# Redefine COOL_include to get the right ROOT_INCLUDE_PATH for local tests
# NB LCG_Interfaces/COOL prepends '$(COOL_include)' to ROOT_INCLUDE_PATH
# NB config defines macro COOL_home as <COOL>/src
macro COOL_include $(COOL_home)/../include

# NB config defines macro COOL_home as <COOL>/src
###path_prepend ROOT_INCLUDE_PATH $(COOL_home)/../include
###path_prepend ROOT_INCLUDE_PATH $(COOL_home)/../$(CMTCONFIG)/python/PyCool/include

#----------------------------------------------------------------------------
# CORAL database plugin runtime
#----------------------------------------------------------------------------

use oracle v* LCG_Interfaces
use mysql  v* LCG_Interfaces
use sqlite v* LCG_Interfaces
use Frontier_Client v* LCG_Interfaces

# work around to set correctly oracle charset (to be put in LCG_Interfaces)
set NLS_LANG american_america.WE8ISO8859P1

# Workaround for obsolete tnsnames.ora in the LHCb cvmfs (bug #92294)
set TNS_ADMIN $(oracle_home)/admin LOCAL /afs/cern.ch/sw/lcg/external/oracle/$(oracle_native_version)/$(LCG_system)/admin

#----------------------------------------------------------------------------
# CORAL Grid runtime
#----------------------------------------------------------------------------

# NB set LFC runtime environment, but some other Grid tools may be missing:
# eventually should make sure that 'source grid_env.csh' is not needed!

###use lfc v* LCG_Interfaces

# disable LFCReplicaSvc by default
###set COOL_IGNORE_LFC "yes"

# For coral_replica_manager
path_remove PATH '/CORAL/' target-winxp '\CORAL\'
path_append PATH $(CORAL_home)/bin

#----------------------------------------------------------------------------
# COOL Examples runtime
#----------------------------------------------------------------------------

# NB config defines macro COOL_home as <COOL>/src
###macro EXAMPLESBINDIR $(COOL_home)/../$(CMTCONFIG)/examples/bin
###macro EXAMPLESLIBDIR $(COOL_home)/../$(CMTCONFIG)/examples/lib
###path_prepend PATH "$(EXAMPLESBINDIR)"
###path_prepend PATH "" target-winxp "$(EXAMPLESLIBDIR)"
###path_prepend LD_LIBRARY_PATH "$(EXAMPLESLIBDIR)" target-winxp ""

#----------------------------------------------------------------------------
# COOL Tests runtime
#----------------------------------------------------------------------------

use CppUnit v* LCG_Interfaces

# needed by Coral XML stuff
use XercesC v* LCG_Interfaces 

# NB config defines macro COOL_home as <COOL>/src
###macro EXAMPLESBINDIR $(COOL_home)/../$(CMTCONFIG)/examples/bin
###macro TESTSBINDIR $(COOL_home)/../$(CMTCONFIG)/tests/bin
###path_prepend PATH $(TESTSBINDIR)

use QMtest v* LCG_Interfaces
set QMTEST_CLASS_PATH $(config_root)/qmtest

# Useful variables for tests
set REFERENCEDBSCRIPTS $(PyCoolUtilities_root)/tests/Regression \
    target-winxp $(PyCoolUtilities_root)\tests\Regression
set COOL_DISABLE_CORALCONNECTIONPOOLCLEANUP 1
set COOL_ENABLE_COOLMSGREPORTER 1
set COOL_MSGLEVEL Error
###set COOL_MSGLEVEL Verbose
###set COOL_QMTEST_SKIPEVOLVE 1

# [NB Signal handlers for qmtest tests are defined in COOLTests.py too]
# Enable the COOL signal handler (disable the ROOT one in this case!)
# TEMPORARY? disable the COOL signal handler for ROOT6 tests (bug #102651)
###set COOL_ENABLE_COOLSIGNALHANDLER 1 
# Enable the ROOT signal handler (disable the COOL one in this case!)
###set LD_PRELOAD libCore.so:libdl.so

# Enable the new algorithm for MV bulk insertion (bug #17903)
# The same value would be used by default if this variable was not set
set COOL_MVINSERTION_PREFETCH_MAXROWS 1000

# Workaround for bug #40326 in SQLite tests
set CORAL_SQLITE_TEMP_STORE_MEMORY 1

# Select from sys.xxx$ tables in CORAL data dictionary queries
# [done for avalassi, lcg_cool, lcg_cool_nightly even if this env is not set]
###set CORAL_ORA_SELECT_FROM_SYS_TABLES

# Workaround for ORA-01466 on Oracle 11g (bug #89735)
###set COOL_TESTSUITE_SLEEPFOR01466 1

# Use the valgrind suppression file from CORAL
set CORAL_TESTSUITE_VALGRIND_SUPP "$(CORAL_base)/src/config/scripts/valgrind.supp"

# Force immediate reload of short-lived cached queries (task #3440)
set FRONTIER_FORCERELOAD short
# Force immediate reload of all queries (workaround for Frontier bug #42465)
###set FRONTIER_FORCERELOAD long

# Variables for schema evolution tests
set LOCALRT $(CMTINSTALLAREA)
set LCGRELEASES $(LCG_releases)

# Variables for tests logging
set CORAL_BASE  $(CORAL_base)
set ROOT_BASE   $(ROOT_home)
set REFLEX_BASE $(ROOT_home)

# Useful for debugging
use valgrind v* LCG_Interfaces

#----------------------------------------------------------------------------
# Additional runtime for the COOL nightly tests
# Some settings are different on the various slots
#----------------------------------------------------------------------------

# Configure which tests are run by QMtest using COOL_QMTEST_TARGET
# [Allowed values: cool, cool_nomysql, cool_sqlite]
# Run only SQLite by default (e.g. for test slots and new dev slots)
# Run all backends on the release, dev (preview) and dev1 (patches) slots
# In LCG_Builders/COOL/scripts/COOL_test.sh: 'qmtest run $COOL_QMTEST_TARGET'
set COOL_QMTEST_TARGET  cool_sqlite \
    lcg_ngt_slt_release cool \
    lcg_ngt_slt_dev     cool \
    lcg_ngt_slt_dev1    cool

#----------------------------------------------------------------------------
# Actions and build rules
#----------------------------------------------------------------------------

# Fake target for tests
action tests "echo No tests in this package"
macro_remove cmt_actions_constituents "tests"

# Fake target for utilities
action utilities "echo No utilities in this package"
macro_remove cmt_actions_constituents "utilities"

# Fake target for examples
action examples "echo No examples in this package"
macro_remove cmt_actions_constituents "examples"
 
#============================================================================

